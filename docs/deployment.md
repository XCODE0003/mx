# MXSite Deployment Pipeline

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π CI/CD —á–µ—Ä–µ–∑ GitHub Actions (`.github/workflows/deploy.yml`), –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–ø–ª–æ–π –Ω–∞ –∫–∞–∂–¥–æ–º –ø—É—à–µ –≤ `main` (–∏–ª–∏ –≤—Ä—É—á–Ω—É—é).

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. üîÑ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH (–ø–æ –ø–∞—Ä–æ–ª—é)
2. üì• –°—Ç—è–≥–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PHP –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Composer)
4. üèóÔ∏è –°–æ–±–∏—Ä–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (npm build)
5. ‚ö° –û—á–∏—â–∞–µ—Ç –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–µ—à–∏ Laravel
6. üíæ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`MX.sql`)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (3 —Å–µ–∫—Ä–µ—Ç–∞)

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (`Settings > Secrets and variables > Actions`):

| –°–µ–∫—Ä–µ—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| `SSH_HOST` | IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ | `123.45.67.89` |
| `SSH_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH | `kim365_ru_usr` |
| `SSH_PASSWORD` | –ü–∞—Ä–æ–ª—å –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ | `–≤–∞—à_–ø–∞—Ä–æ–ª—å` |

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:**
- `SSH_PORT` ‚Äî –ø–æ—Ä—Ç SSH (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `22`)

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/var/www/kim365_ru_usr/data/www/kim365.ru/`:

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git fetch --all --prune
git checkout main
git reset --hard origin/main

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∞
composer install --no-dev --prefer-dist --optimize-autoloader
npm ci
npm run build

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Laravel
php artisan optimize:clear
php artisan optimize

# –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo mysql -u root kim365_ru < MX.sql
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:

- Git (–Ω–∞—Å—Ç—Ä–æ–µ–Ω remote –Ω–∞ GitHub)
- Composer
- Node.js & npm (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ nvm, –≤–µ—Ä—Å–∏—è 22)
- PHP 8.2+
- MySQL client
- Sudo –¥–æ—Å—Ç—É–ø –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ë–î –±–µ–∑ –ø–∞—Ä–æ–ª—è

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `Actions` –≤ GitHub
2. –í—ã–±–µ—Ä–∏—Ç–µ `deploy` workflow
3. –ù–∞–∂–º–∏—Ç–µ `Run workflow`
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É `main`

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ `git push` –≤ –≤–µ—Ç–∫—É `main` –¥–µ–ø–ª–æ–π –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
